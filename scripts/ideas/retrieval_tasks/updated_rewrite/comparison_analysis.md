# Query Rewrite Strategy Comparison: Comprehensive Analysis

## Overview

We evaluated four query rewriting strategies to determine the optimal approach for multi-turn retrieval across different domains.

### Strategies Evaluated

1.  **Baseline Rewrite** (Human/Original):
    *   The standard rewrite provided in the dataset or generated by the default pipeline.
    *   *Focus*: Naturalness and conversation flow.
2.  **Aggressive Rewrite**:
    *   *Focus*: Keyword richness, entity resolution, and explicit context injection.
    *   *Method*: Forces replacement of pronouns with entity names and ignores conversational naturalness.
3.  **Informative Rewrite**:
    *   *Focus*: Completeness and context expansion.
    *   *Method*: Adds synonyms, background information, and domain vocabulary to the resolved query.
4.  **Rewrite-Then-Edit**:
    *   *Focus*: Iterative refinement.
    *   *Method*: Takes the Baseline rewrite and asks an LLM to "expand" it with related entities and context.

**Metric:** nDCG@10 (Normalized Discounted Cumulative Gain at rank 10) using ELSER retrieval.

## Results Table (nDCG@10)

| Domain | Baseline (Human) | Aggressive | Informative | Rewrite-Then-Edit | **Best Strategy** |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **CLAPNQ** (General) | 0.578 | **0.631** | 0.584 | 0.515 | **Aggressive** |
| **GOVT** (Policy) | 0.517 | 0.529 | **0.552** | 0.535 | **Informative** |
| **CLOUD** (Tech) | **0.438** | 0.369 | 0.366 | 0.311 | **Baseline** |
| **FIQA** (Finance) | **0.436** | 0.409 | 0.384 | 0.354 | **Baseline** |

## Deep Dive Analysis

### 1. CLAPNQ (General Knowledge): Aggression Wins
*   **Winner**: **Aggressive** (+9.2% over Baseline)
*   **Why**: CLAPNQ contains many entity-centric questions ("Who is he?", "Where is it?"). The **Aggressive** strategy's strict instruction to *resolve all pronouns* and *replace generic terms* is highly effective here.
*   **Observation**: The "Informative" strategy also performed well but slightly less so than Aggressive, suggesting that for factoid questions, precision in entity naming is more valuable than adding broad context.

### 2. GOVT (Policy/Civic): Information Wins
*   **Winner**: **Informative** (+6.8% over Baseline)
*   **Why**: Government queries often involve complex, abstract topics (policies, laws, social issues) where exact keyword matching can be difficult due to vocabulary mismatch (e.g., "assistance" vs "welfare").
*   **Observation**: The **Informative** strategy succeeds by adding synonyms and background context, which helps bridge the gap between user terminology and document vocabulary. Even the "Rewrite-Then-Edit" strategy beat the baseline here, confirming that *expansion* is generally beneficial for this domain.

### 3. CLOUD (Technical): Minimalism Wins
*   **Winner**: **Baseline**
*   **Why**: Technical documentation is highly precise. Users often query specific error codes, API names, or service configurations.
*   **Failure Mode**: Both **Aggressive** and **Informative** strategies likely introduced **query drift**. By adding "context" (e.g., expanding "kubernetes" to general cloud concepts) or "synonyms", the search engine retrieves high-level overview pages rather than the specific technical reference needed. **Rewrite-Then-Edit** performed worst (-29%), likely due to severe hallucination of irrelevant technical context.

### 4. FIQA (Financial): Minimalism Wins
*   **Winner**: **Baseline**
*   **Why**: Similar to Cloud, financial queries are often specific and sensitive to terminology.
*   **Failure Mode**: Adding "background info" to financial terms (e.g., expanding a specific stock query with general market terms) dilutes the signal. The **Baseline** remains the most effective because it stays true to the user's specific intent without adding noise.

## "Rewrite-Then-Edit" Performance
The **Rewrite-Then-Edit** strategy (expanding an existing rewrite) was consistently the **weakest performer** overall, except in the Government domain where it beat the baseline but lost to "Informative".
*   **Conclusion**: Iterative expansion often leads to **topic drift**. It is better to generate the correct query from scratch (using the conversation history) than to try to "fix" or "pad" an existing query with more words.

## Final Recommendation: Domain-Specific Routing

No single strategy is optimal for all retrieval tasks. A **Routing Strategy** is recommended:

1.  **Default / Technical / Financial**: Use **Baseline Rewrite**.
    *   *Rationale*: High precision is required; extra context is noise.
2.  **General Knowledge / Entity-Centric**: Use **Aggressive Rewrite**.
    *   *Rationale*: Entity resolution is the primary bottleneck.
3.  **Legal / Policy / Abstract**: Use **Informative Rewrite**.
    *   *Rationale*: Vocabulary mismatch is the primary bottleneck; synonyms and context help.
