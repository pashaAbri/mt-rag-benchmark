# Oracle Retriever Analysis: REWRITE Strategy

## Overview

This analysis explores what would happen if we had an oracle that tells us which retriever (BM25, BGE, or ELSER) to use for each query/turn.

**Oracle Selection Metric**: nDCG@5 (ndcg_cut_5)

---

## Overall Performance Comparison

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain vs Best |
| ------- | ------ | ------ | ------ | ---------- | ------------------- |
| R@1     | 0.0905 | 0.1529 | 0.1871 | **0.2319** | +0.0448 (+23.97%)   |
| R@3     | 0.1892 | 0.3047 | 0.3723 | **0.4439** | +0.0716 (+19.24%)   |
| R@5     | 0.2498 | 0.3813 | 0.4761 | **0.5406** | +0.0644 (+13.53%)   |
| R@10    | 0.3490 | 0.4980 | 0.6078 | **0.6126** | +0.0048 (+0.79%)    |
| nDCG@1  | 0.2111 | 0.3578 | 0.4286 | **0.5354** | +0.1068 (+24.92%)   |
| nDCG@3  | 0.1999 | 0.3258 | 0.3992 | **0.4834** | +0.0842 (+21.10%)   |
| nDCG@5  | 0.2229 | 0.3539 | 0.4378 | **0.5143** | +0.0766 (+17.49%)   |
| nDCG@10 | 0.2636 | 0.4037 | 0.4953 | **0.5443** | +0.0490 (+9.90%)    |

## Oracle Choices Distribution

| Retriever | Times Chosen | Percentage |
| --------- | ------------ | ---------- |
| BM25      | 305          | 39.25%     |
| BGE       | 214          | 27.54%     |
| ELSER     | 258          | 33.20%     |

## Performance by Domain

### CLAPNQ

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.0893 | 0.1742 | 0.2087 | **0.2452** | +0.0365     |
| R@3     | 0.1936 | 0.3753 | 0.4244 | **0.5103** | +0.0860     |
| R@5     | 0.2702 | 0.4619 | 0.5516 | **0.6004** | +0.0488     |
| R@10    | 0.3890 | 0.6063 | 0.7005 | **0.6815** | +-0.0190    |
| nDCG@1  | 0.2452 | 0.4712 | 0.5240 | **0.6154** | +0.0913     |
| nDCG@3  | 0.2182 | 0.4124 | 0.4700 | **0.5587** | +0.0888     |
| nDCG@5  | 0.2453 | 0.4376 | 0.5135 | **0.5796** | +0.0661     |
| nDCG@10 | 0.2937 | 0.4982 | 0.5780 | **0.6136** | +0.0356     |

**Oracle Choices**: BM25: 67 (32.2%), ELSER: 75 (36.1%), BGE: 66 (31.7%)

### FIQA

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.0528 | 0.1296 | 0.1631 | **0.2062** | +0.0431     |
| R@3     | 0.1153 | 0.2492 | 0.3099 | **0.3687** | +0.0587     |
| R@5     | 0.1737 | 0.3077 | 0.4016 | **0.4619** | +0.0602     |
| R@10    | 0.2420 | 0.4183 | 0.5358 | **0.5230** | +-0.0128    |
| nDCG@1  | 0.1278 | 0.3111 | 0.3889 | **0.4944** | +0.1056     |
| nDCG@3  | 0.1199 | 0.2742 | 0.3441 | **0.4188** | +0.0746     |
| nDCG@5  | 0.1460 | 0.2938 | 0.3779 | **0.4501** | +0.0722     |
| nDCG@10 | 0.1737 | 0.3410 | 0.4355 | **0.4743** | +0.0388     |

**Oracle Choices**: BM25: 64 (35.6%), ELSER: 62 (34.4%), BGE: 54 (30.0%)

### GOVT

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.1199 | 0.1565 | 0.1936 | **0.2413** | +0.0477     |
| R@3     | 0.2695 | 0.3130 | 0.3923 | **0.4740** | +0.0816     |
| R@5     | 0.3278 | 0.4039 | 0.5082 | **0.5923** | +0.0841     |
| R@10    | 0.4360 | 0.5280 | 0.6510 | **0.6754** | +0.0244     |
| nDCG@1  | 0.2736 | 0.3433 | 0.4129 | **0.5323** | +0.1194     |
| nDCG@3  | 0.2746 | 0.3287 | 0.4067 | **0.5017** | +0.0950     |
| nDCG@5  | 0.2953 | 0.3682 | 0.4540 | **0.5470** | +0.0929     |
| nDCG@10 | 0.3418 | 0.4199 | 0.5169 | **0.5818** | +0.0648     |

**Oracle Choices**: ELSER: 62 (30.8%), BM25: 92 (45.8%), BGE: 47 (23.4%)

### CLOUD

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.0964 | 0.1477 | 0.1793 | **0.2320** | +0.0527     |
| R@3     | 0.1693 | 0.2710 | 0.3529 | **0.4103** | +0.0574     |
| R@5     | 0.2167 | 0.3383 | 0.4297 | **0.4944** | +0.0648     |
| R@10    | 0.3141 | 0.4226 | 0.5280 | **0.5550** | +0.0270     |
| nDCG@1  | 0.1862 | 0.2926 | 0.3777 | **0.4894** | +0.1117     |
| nDCG@3  | 0.1765 | 0.2761 | 0.3654 | **0.4423** | +0.0769     |
| nDCG@5  | 0.1942 | 0.3035 | 0.3940 | **0.4688** | +0.0748     |
| nDCG@10 | 0.2329 | 0.3420 | 0.4377 | **0.4945** | +0.0568     |

**Oracle Choices**: BM25: 82 (43.6%), ELSER: 59 (31.4%), BGE: 47 (25.0%)

## Key Insights

1. **Most Frequently Chosen**: BM25 is chosen by the oracle 305 times (39.25% of queries)

2. **Average Improvement**: Oracle provides an average improvement of 16.37% over the best individual retriever across all metrics

3. **Primary Metric (nDCG@5) Improvement**: 17.49% improvement over best individual retriever (0.4378 â†’ 0.5143)

---

_Generated by oracle_retriever_analysis.py_
