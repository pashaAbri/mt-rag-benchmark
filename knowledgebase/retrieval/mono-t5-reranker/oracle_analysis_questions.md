# Oracle Retriever Analysis: QUESTIONS Strategy

## Overview

This analysis explores what would happen if we had an oracle that tells us which retriever (BM25, BGE, or ELSER) to use for each query/turn.

**Oracle Selection Metric**: nDCG@5 (ndcg_cut_5)

---

## Overall Performance Comparison

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain vs Best |
| ------- | ------ | ------ | ------ | ---------- | ------------------- |
| R@1     | 0.0631 | 0.0638 | 0.0916 | **0.1266** | +0.0349 (+38.15%)   |
| R@3     | 0.1393 | 0.1538 | 0.2011 | **0.2594** | +0.0583 (+29.00%)   |
| R@5     | 0.1845 | 0.2115 | 0.2694 | **0.3341** | +0.0647 (+24.04%)   |
| R@10    | 0.2505 | 0.2829 | 0.3570 | **0.3849** | +0.0279 (+7.81%)    |
| nDCG@1  | 0.1557 | 0.1519 | 0.2085 | **0.2934** | +0.0849 (+40.74%)   |
| nDCG@3  | 0.1465 | 0.1551 | 0.2079 | **0.2748** | +0.0669 (+32.17%)   |
| nDCG@5  | 0.1644 | 0.1814 | 0.2368 | **0.3049** | +0.0681 (+28.76%)   |
| nDCG@10 | 0.1924 | 0.2116 | 0.2740 | **0.3266** | +0.0526 (+19.21%)   |

## Oracle Choices Distribution

| Retriever | Times Chosen | Percentage |
| --------- | ------------ | ---------- |
| BM25      | 517          | 66.54%     |
| BGE       | 107          | 13.77%     |
| ELSER     | 153          | 19.69%     |

## Performance by Domain

### CLAPNQ

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.0679 | 0.0747 | 0.1005 | **0.1319** | +0.0315     |
| R@3     | 0.1487 | 0.1769 | 0.2190 | **0.2900** | +0.0711     |
| R@5     | 0.2091 | 0.2776 | 0.3016 | **0.3831** | +0.0815     |
| R@10    | 0.2910 | 0.3836 | 0.4087 | **0.4458** | +0.0371     |
| nDCG@1  | 0.1971 | 0.2067 | 0.2452 | **0.3365** | +0.0913     |
| nDCG@3  | 0.1708 | 0.1936 | 0.2362 | **0.3182** | +0.0820     |
| nDCG@5  | 0.1933 | 0.2370 | 0.2692 | **0.3519** | +0.0827     |
| nDCG@10 | 0.2283 | 0.2816 | 0.3153 | **0.3783** | +0.0630     |

**Oracle Choices**: ELSER: 42 (20.2%), BM25: 129 (62.0%), BGE: 37 (17.8%)

### FIQA

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.0269 | 0.0523 | 0.0817 | **0.1053** | +0.0236     |
| R@3     | 0.0761 | 0.0949 | 0.1602 | **0.1942** | +0.0340     |
| R@5     | 0.1028 | 0.1354 | 0.1913 | **0.2345** | +0.0432     |
| R@10    | 0.1373 | 0.1840 | 0.2495 | **0.2634** | +0.0139     |
| nDCG@1  | 0.0833 | 0.1111 | 0.1833 | **0.2444** | +0.0611     |
| nDCG@3  | 0.0765 | 0.0988 | 0.1683 | **0.2093** | +0.0409     |
| nDCG@5  | 0.0872 | 0.1199 | 0.1818 | **0.2261** | +0.0443     |
| nDCG@10 | 0.1018 | 0.1389 | 0.2071 | **0.2386** | +0.0315     |

**Oracle Choices**: BM25: 128 (71.1%), BGE: 19 (10.6%), ELSER: 33 (18.3%)

### GOVT

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.0927 | 0.0760 | 0.1112 | **0.1524** | +0.0412     |
| R@3     | 0.2098 | 0.1875 | 0.2652 | **0.3138** | +0.0486     |
| R@5     | 0.2565 | 0.2263 | 0.3540 | **0.4059** | +0.0520     |
| R@10    | 0.3354 | 0.3029 | 0.4498 | **0.4692** | +0.0194     |
| nDCG@1  | 0.1940 | 0.1542 | 0.2338 | **0.3184** | +0.0846     |
| nDCG@3  | 0.2090 | 0.1790 | 0.2621 | **0.3212** | +0.0591     |
| nDCG@5  | 0.2271 | 0.1966 | 0.3000 | **0.3608** | +0.0609     |
| nDCG@10 | 0.2607 | 0.2299 | 0.3397 | **0.3883** | +0.0486     |

**Oracle Choices**: BM25: 134 (66.7%), ELSER: 44 (21.9%), BGE: 23 (11.4%)

### CLOUD

| Metric  | BM25   | BGE    | ELSER  | Oracle     | Oracle Gain |
| ------- | ------ | ------ | ------ | ---------- | ----------- |
| R@1     | 0.0607 | 0.0498 | 0.0704 | **0.1134** | +0.0430     |
| R@3     | 0.1142 | 0.1484 | 0.1519 | **0.2297** | +0.0779     |
| R@5     | 0.1584 | 0.1954 | 0.2180 | **0.2984** | +0.0804     |
| R@10    | 0.2232 | 0.2449 | 0.3037 | **0.3438** | +0.0401     |
| nDCG@1  | 0.1383 | 0.1277 | 0.1649 | **0.2660** | +0.1011     |
| nDCG@3  | 0.1198 | 0.1408 | 0.1565 | **0.2398** | +0.0833     |
| nDCG@5  | 0.1392 | 0.1625 | 0.1861 | **0.2687** | +0.0826     |
| nDCG@10 | 0.1663 | 0.1843 | 0.2220 | **0.2877** | +0.0657     |

**Oracle Choices**: BM25: 126 (67.0%), BGE: 28 (14.9%), ELSER: 34 (18.1%)

## Key Insights

1. **Most Frequently Chosen**: BM25 is chosen by the oracle 517 times (66.54% of queries)

2. **Average Improvement**: Oracle provides an average improvement of 27.49% over the best individual retriever across all metrics

3. **Primary Metric (nDCG@5) Improvement**: 28.76% improvement over best individual retriever (0.2368 â†’ 0.3049)

---

_Generated by oracle_retriever_analysis.py_
