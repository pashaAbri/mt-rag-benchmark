# Oracle Retriever Analysis: LASTTURN Strategy

## Overview

This analysis explores what would happen if we had an oracle that tells us which retriever (BM25, BGE, or ELSER) to use for each query/turn.

**Oracle Selection Metric**: nDCG@5 (ndcg_cut_5)

---

## Overall Performance Comparison

| Metric | BM25 | BGE | ELSER | Oracle | Oracle Gain vs Best |
|--------|------|-----|-------|--------|---------------------|
| R@1 | 0.0816 | 0.1296 | 0.1725 | **0.2086** | +0.0361 (+20.92%) |
| R@3 | 0.1668 | 0.2592 | 0.3490 | **0.4034** | +0.0544 (+15.59%) |
| R@5 | 0.2152 | 0.3267 | 0.4394 | **0.4912** | +0.0518 (+11.79%) |
| R@10 | 0.2992 | 0.4277 | 0.5445 | **0.5571** | +0.0126 (+2.31%) |
| nDCG@1 | 0.1866 | 0.2986 | 0.3887 | **0.4749** | +0.0862 (+22.19%) |
| nDCG@3 | 0.1782 | 0.2767 | 0.3732 | **0.4386** | +0.0654 (+17.53%) |
| nDCG@5 | 0.1961 | 0.3013 | 0.4054 | **0.4664** | +0.0610 (+15.05%) |
| nDCG@10 | 0.2309 | 0.3445 | 0.4511 | **0.4944** | +0.0433 (+9.60%) |

## Oracle Choices Distribution

| Retriever | Times Chosen | Percentage |
|-----------|--------------|------------|
| BM25 | 345 | 44.40% |
| BGE | 168 | 21.62% |
| ELSER | 264 | 33.98% |

## Performance by Domain

### CLAPNQ

| Metric | BM25 | BGE | ELSER | Oracle | Oracle Gain |
|--------|------|-----|-------|--------|-------------|
| R@1 | 0.0774 | 0.1553 | 0.1981 | **0.2254** | +0.0272 |
| R@3 | 0.1684 | 0.3041 | 0.3973 | **0.4531** | +0.0558 |
| R@5 | 0.2231 | 0.3879 | 0.5113 | **0.5517** | +0.0405 |
| R@10 | 0.3367 | 0.5224 | 0.6303 | **0.6413** | +0.0110 |
| nDCG@1 | 0.2067 | 0.3942 | 0.4760 | **0.5337** | +0.0577 |
| nDCG@3 | 0.1903 | 0.3411 | 0.4366 | **0.4964** | +0.0598 |
| nDCG@5 | 0.2078 | 0.3675 | 0.4749 | **0.5231** | +0.0482 |
| nDCG@10 | 0.2552 | 0.4243 | 0.5270 | **0.5607** | +0.0337 |

**Oracle Choices**: BM25: 75 (36.1%), ELSER: 81 (38.9%), BGE: 52 (25.0%)

### FIQA

| Metric | BM25 | BGE | ELSER | Oracle | Oracle Gain |
|--------|------|-----|-------|--------|-------------|
| R@1 | 0.0269 | 0.1032 | 0.1464 | **0.1797** | +0.0332 |
| R@3 | 0.0820 | 0.2068 | 0.2930 | **0.3344** | +0.0414 |
| R@5 | 0.1174 | 0.2632 | 0.3705 | **0.4088** | +0.0383 |
| R@10 | 0.1771 | 0.3672 | 0.4719 | **0.4639** | +-0.0080 |
| nDCG@1 | 0.0722 | 0.2389 | 0.3444 | **0.4278** | +0.0833 |
| nDCG@3 | 0.0815 | 0.2266 | 0.3198 | **0.3748** | +0.0551 |
| nDCG@5 | 0.0972 | 0.2477 | 0.3477 | **0.3999** | +0.0522 |
| nDCG@10 | 0.1217 | 0.2913 | 0.3909 | **0.4229** | +0.0320 |

**Oracle Choices**: BM25: 73 (40.6%), ELSER: 63 (35.0%), BGE: 44 (24.4%)

### GOVT

| Metric | BM25 | BGE | ELSER | Oracle | Oracle Gain |
|--------|------|-----|-------|--------|-------------|
| R@1 | 0.1148 | 0.1333 | 0.1636 | **0.2033** | +0.0397 |
| R@3 | 0.2316 | 0.2643 | 0.3452 | **0.4147** | +0.0695 |
| R@5 | 0.2942 | 0.3336 | 0.4449 | **0.5094** | +0.0644 |
| R@10 | 0.3826 | 0.4270 | 0.5588 | **0.5748** | +0.0160 |
| nDCG@1 | 0.2637 | 0.2985 | 0.3532 | **0.4577** | +0.1045 |
| nDCG@3 | 0.2469 | 0.2773 | 0.3608 | **0.4391** | +0.0782 |
| nDCG@5 | 0.2700 | 0.3047 | 0.4001 | **0.4729** | +0.0729 |
| nDCG@10 | 0.3071 | 0.3443 | 0.4486 | **0.5004** | +0.0518 |

**Oracle Choices**: ELSER: 56 (27.9%), BM25: 109 (54.2%), BGE: 36 (17.9%)

### CLOUD

| Metric | BM25 | BGE | ELSER | Oracle | Oracle Gain |
|--------|------|-----|-------|--------|-------------|
| R@1 | 0.1030 | 0.1224 | 0.1788 | **0.2236** | +0.0448 |
| R@3 | 0.1768 | 0.2543 | 0.3534 | **0.4025** | +0.0491 |
| R@5 | 0.2158 | 0.3122 | 0.4201 | **0.4839** | +0.0638 |
| R@10 | 0.2858 | 0.3814 | 0.5036 | **0.5341** | +0.0305 |
| nDCG@1 | 0.1915 | 0.2500 | 0.3723 | **0.4734** | +0.1011 |
| nDCG@3 | 0.1841 | 0.2527 | 0.3673 | **0.4353** | +0.0680 |
| nDCG@5 | 0.1989 | 0.2759 | 0.3894 | **0.4605** | +0.0711 |
| nDCG@10 | 0.2269 | 0.3074 | 0.4273 | **0.4829** | +0.0556 |

**Oracle Choices**: BM25: 88 (46.8%), ELSER: 64 (34.0%), BGE: 36 (19.1%)

## Key Insights

1. **Most Frequently Chosen**: BM25 is chosen by the oracle 345 times (44.40% of queries)

2. **Average Improvement**: Oracle provides an average improvement of 14.37% over the best individual retriever across all metrics

3. **Primary Metric (nDCG@5) Improvement**: 15.05% improvement over best individual retriever (0.4054 â†’ 0.4664)

---

*Generated by oracle_retriever_analysis.py*
